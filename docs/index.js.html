<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/** EXTERNAL DEPENDENCIES */
const express = require("express");
const github = require('octonode');


/** INIT */
const app = express();
const port = 5000;
 
/**
 * this is a route that give request to access the 
 * /api/repositories of a user but first you suposse to have the token 
 * 
 */
app.get('/api/repositories' , async (req, res, next) => {
    try {
        // EXTRACT TOKEN FROM HEADERS
        /**
         * A token that we can take it from headers.
         * check if there is a token?
         * if there is't a token give a error
         */
        const token = req.headers.token;
        // CHECK IF TOKEN IS PRESENT
        if(!token) {
            // IF NOT THROW AN ERROR
            const tokenError = new Error('No token found');
            tokenError.status = 401;
            return next(tokenError);
        }
         // EXTRACT QUERY PARAM
         /**
          * the name we are getting from req.query.name 
          * we are waiting for the getRepositoriesOfUser to 
          * map theow the repositories and give the repository 
          */
        const name = req.query.name
        // GET ALL REPOSITORIES
        const repositories = await getRepositoriesOfUser(token, name);
        // RETURN REPOSITORIES TO THE USER
        res.json(repositories);
        /**
         * if there is error some where in the funtion 
         * this will catch it
         */
    } catch (error) {
        next(error)
    }
});

/**
 * this fuction get the repositoies of user but frist you supose
 *  to have the token and the name
 * @param {string} token 
 * @param {string} name 
 * @returns {object} give us name, url and langauge of the repositories
 */
const getRepositoriesOfUser = (token, name) => 
/**
 * class promise that give you a resolve or reject 
 */
    new Promise((resolve, reject) => {
          // SET UP GITHUB CLIENT

          /**
           * this will take the github client token
           */
        const client = github.client(token);
          // GHME REFERS NOW TO THE OWNER OF THE TOKEN
          /**
           * githubme or ghme refers to the owner of the github
           */
        const ghme = client.me();
        // HERE FETCH ALL THE REPOSITORIES
        /**
         * this will fetch the repos find if there is error or data
         */
        ghme.repos((err, data, headers) => {
            if(err) {
                return reject(err);
            }
            // I MAP THROUG REPOSITORIES AND FILTER IN CASE THERE IS PARAMETER NAME

            /**
             * I map throw the repo and filter the name, url and langauge
             */
            const repositories = data.map((repo) => ({
                name: repo.name,
                url: repo.url,
                langauge: repo.langauge,
            }))
            /**
             * after the map i filter throw the repo, in case there is parameter name
             * i filter the name, url and langauge of every repositories
             * i write the repo name in lower case. In case the repositories name are 
             * written in uppercase i will in lowercase.
             */
            .filter((repo) => 
            name ? repo.name.toLocaleLowerCase().includes(name.toLocaleLowerCase()) : true
            );
            /**
             * If it find the same repositories name that i give us a 
             * param name then i will return to us
             */
            
            resolve({ repositories});
        });
    });

    // HANDLING ALL ERRORS
    /**
     * this is a middle ware that handle the errors
     */
 app.use((error, req, res, next) => {
    res.status(error.status || 500).send(error);
  });

/**
 * the app is listeing to 5000
 */
 app.listen(port, () => {
     console.log(`App is listening on port ${port}`)
 });</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#app">app</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#getRepositoriesOfUser">getRepositoriesOfUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Sep 24 2020 16:36:58 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
